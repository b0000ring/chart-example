<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:Alex Chirkin]">
<meta name="description" content="Integration of D3 data visualizations into front-end applications can be a tricky task, when a plot lifecycle is controlled by the application, sometimes it may be unclear how to properly connect the plot and the application. In this article, I describe some ways to update plots with saving their internal state.
Plot internal state When creating a D3 plot to visualize some data it frequently happens that to improve user experience some interactivity should be added." />
<meta name="keywords" content="chartexample.com, blog, charts, d3, visualizations, plots, blog, d3, state, plot, lifecycle" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://chartexample.com/blog/chart-lifecycle/" />


    <title>
        
            State in D3 chart lifecycle :: chartexample.com  â€” Blog about creating charts and data visualizations
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.14ebb2bdf48093b5d86ce6df5b88b815b907e3c52d59024151a56e018ff1e6c8.css" integrity="sha256-FOuyvfSAk7XYbObfW4i4FbkH48UtWQJBUaVuAY/x5sg=">


    
        <link rel="stylesheet" type="text/css" href="/style.css">
    


<link rel="shortcut icon" href="/favicon.ico">


<meta itemprop="name" content="State in D3 chart lifecycle">
<meta itemprop="description" content="Integration of D3 data visualizations into front-end applications can be a tricky task, when a plot lifecycle is controlled by the application, sometimes it may be unclear how to properly connect the plot and the application. In this article, I describe some ways to update plots with saving their internal state.
Plot internal state When creating a D3 plot to visualize some data it frequently happens that to improve user experience some interactivity should be added."><meta itemprop="datePublished" content="2022-10-23T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-10-23T00:00:00+00:00" />
<meta itemprop="wordCount" content="1904"><meta itemprop="image" content="https://chartexample.com"/>
<meta itemprop="keywords" content="blog,d3,state,plot,lifecycle," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://chartexample.com"/>

<meta name="twitter:title" content="State in D3 chart lifecycle"/>
<meta name="twitter:description" content="Integration of D3 data visualizations into front-end applications can be a tricky task, when a plot lifecycle is controlled by the application, sometimes it may be unclear how to properly connect the plot and the application. In this article, I describe some ways to update plots with saving their internal state.
Plot internal state When creating a D3 plot to visualize some data it frequently happens that to improve user experience some interactivity should be added."/>







    <meta property="article:published_time" content="2022-10-23 00:00:00 &#43;0000 UTC" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark"></span>
            <span class="logo__text ">
                chartexample.com
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/blog/">Blog</a></li><li><a href="/charts">Charts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://chartexample.com/blog/chart-lifecycle/">State in D3 chart lifecycle</a></h2>

            
            
            

            <div class="post-content">
                <p><img src="/covers/state-lifecycle.png" alt="Tux, the Linux mascot"></p>
<p>Integration of D3 data visualizations into front-end applications can be a tricky task, when a plot lifecycle is controlled by the application,
sometimes it may be unclear how to properly connect the plot and the application.
In this article, I describe some ways to update plots with saving their internal state.</p>
<h2 id="plot-internal-state">Plot internal state</h2>
<p>When creating a D3 plot to visualize some data it frequently happens that to improve user experience some interactivity should be added. And with interactivity usually comes state and with that, the complexity of the plot lifecycle can increase rapidly. Many different things can be stored in the plot state, like scrolling position, selected elements, zoom value, etc.
Basically, that can be any effect of possible user input not directly related to data changes.</p>
<p>The standard lifecycle for the D3 plot (as for most other libraries) looks like this:</p>
<ul>
<li>Initial render
<ul>
<li>applying data</li>
<li>rendering of the plot components</li>
</ul>
</li>
<li>Update
<ul>
<li>applying new data</li>
<li>re-rendering of the plot components</li>
</ul>
</li>
<li>Destruction
<ul>
<li>cleanup of rendered components and any other possible connections (like subscriptions for events and etc.)</li>
</ul>
</li>
</ul>
<p>To achieve a saving of the internal state of the plot the lifecycle should be implemented in some specific way.</p>
<h2 id="redraw-plot-from-scratch">Redraw plot from scratch</h2>
<p>For the simple plot, which represents some data without big data processing or the expectation of user input, the destruction step can be used to redraw the entire visualization, instead of separating update logic. This means that the plot should be destroyed and rendered again from scratch on any data update. This approach helps to keep plot rendering logic straightforward, but it also clears any state the plot can store.</p>
<p><em>The Example below shows that zoom and scroll position will be reset after any data update and plot redraw (try to scroll or zoom and then click on the &lsquo;Update data&rsquo; button)</em></p>

<svg class="plot" style="width: 100%; height:300px" id="example1"></svg>
<button onclick="addExample1Data()">Update data</button>
<script src="/blog/chart-lifecycle/example1.js"></script>

<details>
  <summary>show code example</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 1&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 2&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 4&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 3&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 5&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">drawExample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">plot</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#example1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;*&#39;</span>).<span style="color:#a6e22e">remove</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodeSeparation</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">hierarchy</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">children</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lnkMkr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">linkHorizontal</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">x</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">y</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">zoom</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoom</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">extent</span>([[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>]])
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;zoom&#39;</span>, ({ <span style="color:#a6e22e">transform</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;transform&#39;</span>, <span style="color:#a6e22e">transform</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;defs&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;circle&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;node&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;r&#39;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cx&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cy&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>.<span style="color:#a6e22e">transform</span>, <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoomIdentity</span>.<span style="color:#a6e22e">translate</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">50</span>).<span style="color:#a6e22e">scale</span>(<span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">tree</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">nodeSize</span>([<span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>, <span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>])(<span style="color:#a6e22e">nodes</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">links</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">lnkMkr</span>(<span style="color:#a6e22e">d</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;stroke&#39;</span>, <span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;none&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">descendants</span>(), <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">join</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">enter</span> =&gt; <span style="color:#a6e22e">enter</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>).<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">renderItem</span>),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderItem</span>(<span style="color:#a6e22e">selection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;use&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;href&#39;</span>, <span style="color:#e6db74">&#39;#node&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;text&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;white&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;text-anchor&#39;</span>, <span style="color:#e6db74">&#39;middle&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">text</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selection</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// function changes dataset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addExample1Data</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;created&#39;</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">drawExample1</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</details>
<p>To avoid state clearing after every update, only a specific part of the plot function should run on data change. There are several ways how this can be achieved.</p>
<h2 id="run-state-initialization-logic-on-the-first-render">Run state initialization logic on the first render</h2>
<p>This way works best if the plot does not contain any state which affects data or is related to data itself (like item selections, user inputs, etc.) but has some state of the plot view (zoom, scrolling, elements positioning, and others like that).</p>
<p>To avoid extraction of update logic and complexity increasing, a condition can be used to execute part of the plot function with initialization of some stateful functionality only on the first run (when the plot is rendered initially).</p>
<p>The concrete condition may be different, it depends on the implementation of the plot. For example check of the root container (like some g element or svg element itself) emptiness can be used for that.</p>
<p><em>Try to scroll or zoom and then click on the &lsquo;Update data&rsquo; button, the position will be the same after plot update</em></p>

<svg class="plot" style="width: 100%; height:300px" id="example2"></svg>
<button onclick="addExample2Data()">Update data</button>
<script src="/blog/chart-lifecycle/example2.js"></script>

<details>
  <summary>show code example</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data2</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 1&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 2&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 4&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 3&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 5&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">drawExample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">plot</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#example2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodeSeparation</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">hierarchy</span>(<span style="color:#a6e22e">data2</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">children</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lnkMkr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">linkHorizontal</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">x</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">y</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// everything related to state initilization is hidden 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// under first render condition
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">selectChildren</span>().<span style="color:#a6e22e">size</span>()) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">zoom</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoom</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">extent</span>([[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>]])
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;zoom&#39;</span>, ({ <span style="color:#a6e22e">transform</span> }) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;transform&#39;</span>, <span style="color:#a6e22e">transform</span>)
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;defs&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;circle&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;node&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;r&#39;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cx&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cy&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plot</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>.<span style="color:#a6e22e">transform</span>, <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoomIdentity</span>.<span style="color:#a6e22e">translate</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">50</span>).<span style="color:#a6e22e">scale</span>(<span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// everything related to the update cycle is called every time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">tree</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">nodeSize</span>([<span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>, <span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>])(<span style="color:#a6e22e">nodes</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">links</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">lnkMkr</span>(<span style="color:#a6e22e">d</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;stroke&#39;</span>, <span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;none&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">descendants</span>(), <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">join</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">enter</span> =&gt; <span style="color:#a6e22e">enter</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>).<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">renderItem</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">update</span> =&gt; <span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">updateItem</span>).<span style="color:#a6e22e">raise</span>(),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderItem</span>(<span style="color:#a6e22e">selection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;use&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;href&#39;</span>, <span style="color:#e6db74">&#39;#node&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;text&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;white&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;text-anchor&#39;</span>, <span style="color:#e6db74">&#39;middle&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">text</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selection</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateItem</span>(<span style="color:#a6e22e">selection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;use&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;text&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selection</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addExample2Data</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data2</span>.<span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;created&#39;</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">drawExample2</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</details>
<p>Pros and cons of this method:</p>
<ul>
<li>
<p>Pros:</p>
<ul>
<li>Implementation simplicity</li>
<li>No need to store the update function for the plot instance</li>
<li>The same function can be easily used for different containers, by passing the container as the function param</li>
</ul>
</li>
<li>
<p>Cons:</p>
<ul>
<li>Only the plot and its elements state can be easily stored this way</li>
<li>Update logic placed inside the plot function. For complex cases, this can be complicated to support</li>
</ul>
</li>
</ul>
<h2 id="extract-update-logic-into-return-function">Extract update logic into return function</h2>
<p>If some more complicated state, like custom data object not directly related to the visualization elements, needs to be stored between updates, one of the possible ways to implement the plot lifecycle is to return update function from the initial render. In that case, the state will be saved in function closure and will be accessible in the update function.</p>
<p>The main thing to consider is that the update function should be stored and accessible in the application.</p>
<p><em>In the example below try to click on some nodes. Their data will be added to the internal Set object and will be used between re-renders to highlight selected nodes with different color</em></p>

<svg class="plot" style="width: 100%; height:300px" id="example3"></svg>
<button onclick="addExample3Data()">Update data</button>
<script src="/blog/chart-lifecycle/example3.js"></script>

<details>
  <summary>show code example</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">updatePlot</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data3</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 1&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 2&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 4&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 3&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node 5&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// function implements chart rendering
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// example with rendered check
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">drawExample3</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">plot</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#example3&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// the custom state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodeSeparation</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nodes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">lnkMkr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">getBoundingClientRect</span>().<span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">zoom</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoom</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">extent</span>([[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>]])
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;zoom&#39;</span>, ({ <span style="color:#a6e22e">transform</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;transform&#39;</span>, <span style="color:#a6e22e">transform</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;defs&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;circle&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;node&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;r&#39;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cx&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cy&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>.<span style="color:#a6e22e">transform</span>, <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">zoomIdentity</span>.<span style="color:#a6e22e">translate</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">50</span>).<span style="color:#a6e22e">scale</span>(<span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">zoom</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;#plot-content&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// initial call of render function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">render</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderItem</span>(<span style="color:#a6e22e">selection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;use&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;href&#39;</span>, <span style="color:#e6db74">&#39;#node&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#a6e22e">getFill</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;text&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;white&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;text-anchor&#39;</span>, <span style="color:#e6db74">&#39;middle&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">text</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selection</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateItem</span>(<span style="color:#a6e22e">selection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;use&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#a6e22e">getFill</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;text&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selection</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFill</span>(<span style="color:#a6e22e">d</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">name</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;green&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;red&#39;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// function that updates everything that depends on the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">hierarchy</span>(<span style="color:#a6e22e">data3</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">children</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lnkMkr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">linkHorizontal</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">x</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">y</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">tree</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">nodeSize</span>([<span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>, <span style="color:#a6e22e">r</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nodeSeparation</span>])(<span style="color:#a6e22e">nodes</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">links</span>())
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;path&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">lnkMkr</span>(<span style="color:#a6e22e">d</span>))
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;stroke&#39;</span>, <span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;fill&#39;</span>, <span style="color:#e6db74">&#39;none&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;g&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">data</span>(<span style="color:#a6e22e">nodes</span>.<span style="color:#a6e22e">descendants</span>(), <span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">d</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">join</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">enter</span> =&gt; <span style="color:#a6e22e">enter</span>.<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#39;g&#39;</span>).<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">renderItem</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">update</span> =&gt; <span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">updateItem</span>).<span style="color:#a6e22e">raise</span>(),
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span>, <span style="color:#a6e22e">d</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updateItem</span>(<span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#66d9ef">this</span>))
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;cursor&#39;</span>, <span style="color:#e6db74">&#39;pointer&#39;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// returning function that redraws the plot after updating the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">render</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// function changes dataset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addExample3Data</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data3</span>.<span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;created&#39;</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// calling update function instead of the plot function itself
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">updatePlot</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// saving update function somewhere outside the plot after initial render
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">updatePlot</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">drawExample3</span>() 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</details>
<p>Pros and cons of this method:</p>
<ul>
<li>
<p>Pros:</p>
<ul>
<li>Any type of state can be saved between updates</li>
<li>No need for additional logic for handling different parts of initial and update renders</li>
</ul>
</li>
<li>
<p>Cons:</p>
<ul>
<li>Update function should be stored for the plot instance</li>
<li>Separated update function can add complexity to the plot structure</li>
</ul>
</li>
</ul>
<h2 id="implement-plot-as-an-object-with-render-and-update-functions">Implement plot as an object with render and update functions</h2>
<p>It is useful to structure the plot logic as a JavaScript class for complicated cases. Splitting render/update logic parts into object methods can help handle complex data changes and visual component updates.
With proper implementation, it is easy to use object methods separately or as a part of a common update logic.</p>
<p>This way of structuring a plot gives even more advantages in managing the internal plot state. JavaScript objects can have their own properties easily accessible through this keyword inside the object methods. This makes it possible to get and set the state in every method of the plot object or create an entire &lsquo;API&rsquo; inside of the object, for managing the internal state with proper reactions and updates.</p>
<p><em>How to create a plot as a JavaScript object is a complex topic, which requires an entire article to explain. The code below is just a draft showcase of possible implementation.</em></p>
<details>
  <summary>show implementation draft</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Plot</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">state</span>, <span style="color:#a6e22e">data</span>, ...<span style="color:#a6e22e">otherProps</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// common object for internal state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        ...<span style="color:#a6e22e">state</span>,
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// applying initial data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ...other initial props applying...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">render</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ...all the initial rendering logic...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setData</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">data</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">update</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setState</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">newState</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        ...<span style="color:#a6e22e">newState</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">update</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">update</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ... all the update logic...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">plot</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Plot</span>(<span style="color:#75715e">/*pass initial props here*/</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot</span>.<span style="color:#a6e22e">setData</span>(<span style="color:#a6e22e">newData</span>)
</span></span></code></pre></div>
</details>
<p>Pros and cons of this method:</p>
<ul>
<li>
<p>Pros:</p>
<ul>
<li>For the complex state (for example with update side effects) it is easy to create an internal &lsquo;API&rsquo; for changes handling</li>
<li>Plot instance object provides an access to its methods and state, which makes it easier to work with it from the application</li>
<li>All the other benefits of classes and objects usage</li>
</ul>
</li>
<li>
<p>Cons:</p>
<ul>
<li>Knowledge of how to work with objects in JavaScript needed</li>
<li>Internal complexity of the plot logic can grow significantly</li>
</ul>
</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>The problem of a state in D3 charts can be difficult to solve. However, because of the incredible flexibility that the library provides, it is always possible. The exact implementation way should depend on the initial problem complexity and balance between expandability and ease of maintenance.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://chartexample.com/tags/blog/">blog</a></span>
        <span class="tag"><a href="https://chartexample.com/tags/d3/">d3</a></span>
        <span class="tag"><a href="https://chartexample.com/tags/state/">state</a></span>
        <span class="tag"><a href="https://chartexample.com/tags/plot/">plot</a></span>
        <span class="tag"><a href="https://chartexample.com/tags/lifecycle/">lifecycle</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            
            <span><a href="https://chartexample.com">Alex Chirkin</a></span>
            
            
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>


    
        <script src="https://d3js.org/d3.v7.min.js"></script>
    


    </body>
</html>
